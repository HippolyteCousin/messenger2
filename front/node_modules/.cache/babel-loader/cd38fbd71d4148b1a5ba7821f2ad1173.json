{"ast":null,"code":"'use strict';\n\nmodule.exports = function clear(db, location, keyRange, options, callback) {\n  if (options.limit === 0) return db._nextTick(callback);\n  var transaction = db.db.transaction([location], 'readwrite');\n  var store = transaction.objectStore(location);\n  var count = 0;\n\n  transaction.oncomplete = function () {\n    callback();\n  };\n\n  transaction.onabort = function () {\n    callback(transaction.error || new Error('aborted by user'));\n  }; // A key cursor is faster (skips reading values) but not supported by IE\n\n\n  var method = store.openKeyCursor ? 'openKeyCursor' : 'openCursor';\n  var direction = options.reverse ? 'prev' : 'next';\n\n  store[method](keyRange, direction).onsuccess = function (ev) {\n    var cursor = ev.target.result;\n\n    if (cursor) {\n      // Wait for a request to complete before continuing, saving CPU.\n      store.delete(cursor.key).onsuccess = function () {\n        if (options.limit <= 0 || ++count < options.limit) {\n          cursor.continue();\n        }\n      };\n    }\n  };\n};","map":{"version":3,"sources":["/home/duck/Documents/tweb/messenger2/frontend/node_modules/level-js/util/clear.js"],"names":["module","exports","clear","db","location","keyRange","options","callback","limit","_nextTick","transaction","store","objectStore","count","oncomplete","onabort","error","Error","method","openKeyCursor","direction","reverse","onsuccess","ev","cursor","target","result","delete","key","continue"],"mappings":"AAAA;;AAEAA,MAAM,CAACC,OAAP,GAAiB,SAASC,KAAT,CAAgBC,EAAhB,EAAoBC,QAApB,EAA8BC,QAA9B,EAAwCC,OAAxC,EAAiDC,QAAjD,EAA2D;AAC1E,MAAID,OAAO,CAACE,KAAR,KAAkB,CAAtB,EAAyB,OAAOL,EAAE,CAACM,SAAH,CAAaF,QAAb,CAAP;AAEzB,MAAIG,WAAW,GAAGP,EAAE,CAACA,EAAH,CAAMO,WAAN,CAAkB,CAACN,QAAD,CAAlB,EAA8B,WAA9B,CAAlB;AACA,MAAIO,KAAK,GAAGD,WAAW,CAACE,WAAZ,CAAwBR,QAAxB,CAAZ;AACA,MAAIS,KAAK,GAAG,CAAZ;;AAEAH,EAAAA,WAAW,CAACI,UAAZ,GAAyB,YAAY;AACnCP,IAAAA,QAAQ;AACT,GAFD;;AAIAG,EAAAA,WAAW,CAACK,OAAZ,GAAsB,YAAY;AAChCR,IAAAA,QAAQ,CAACG,WAAW,CAACM,KAAZ,IAAqB,IAAIC,KAAJ,CAAU,iBAAV,CAAtB,CAAR;AACD,GAFD,CAX0E,CAe1E;;;AACA,MAAIC,MAAM,GAAGP,KAAK,CAACQ,aAAN,GAAsB,eAAtB,GAAwC,YAArD;AACA,MAAIC,SAAS,GAAGd,OAAO,CAACe,OAAR,GAAkB,MAAlB,GAA2B,MAA3C;;AAEAV,EAAAA,KAAK,CAACO,MAAD,CAAL,CAAcb,QAAd,EAAwBe,SAAxB,EAAmCE,SAAnC,GAA+C,UAAUC,EAAV,EAAc;AAC3D,QAAIC,MAAM,GAAGD,EAAE,CAACE,MAAH,CAAUC,MAAvB;;AAEA,QAAIF,MAAJ,EAAY;AACV;AACAb,MAAAA,KAAK,CAACgB,MAAN,CAAaH,MAAM,CAACI,GAApB,EAAyBN,SAAzB,GAAqC,YAAY;AAC/C,YAAIhB,OAAO,CAACE,KAAR,IAAiB,CAAjB,IAAsB,EAAEK,KAAF,GAAUP,OAAO,CAACE,KAA5C,EAAmD;AACjDgB,UAAAA,MAAM,CAACK,QAAP;AACD;AACF,OAJD;AAKD;AACF,GAXD;AAYD,CA/BD","sourcesContent":["'use strict'\n\nmodule.exports = function clear (db, location, keyRange, options, callback) {\n  if (options.limit === 0) return db._nextTick(callback)\n\n  var transaction = db.db.transaction([location], 'readwrite')\n  var store = transaction.objectStore(location)\n  var count = 0\n\n  transaction.oncomplete = function () {\n    callback()\n  }\n\n  transaction.onabort = function () {\n    callback(transaction.error || new Error('aborted by user'))\n  }\n\n  // A key cursor is faster (skips reading values) but not supported by IE\n  var method = store.openKeyCursor ? 'openKeyCursor' : 'openCursor'\n  var direction = options.reverse ? 'prev' : 'next'\n\n  store[method](keyRange, direction).onsuccess = function (ev) {\n    var cursor = ev.target.result\n\n    if (cursor) {\n      // Wait for a request to complete before continuing, saving CPU.\n      store.delete(cursor.key).onsuccess = function () {\n        if (options.limit <= 0 || ++count < options.limit) {\n          cursor.continue()\n        }\n      }\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"script"}